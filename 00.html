<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>00</title>
        <style>
        canvas {
            width:100%;height:100%;
        }
        </style>
    </head>
    <body>
        <canvas id="c"></canvas>
    </body>
    <script src="lib.js"></script>
    <script>
    var canvas = document.getElementById('c');
    var gl = canvas.getContext('webgl2');
    if(!gl) console.error('webgl initialize failed');
    var vShaderSource = `#version 300 es
in vec2 a_position;
uniform vec2 u_resolution;
void main() {
  vec2 zeroToOne = a_position / u_resolution;
  vec2 zeroToTwo = zeroToOne * 2.0;
  vec2 clipSpace = zeroToTwo - 1.0;
  
  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
}`;
    var fShaderSource = `#version 300 es
precision mediump float;
uniform vec4 u_color;
out vec4 outColor;

void main() {
  outColor = u_color;
}`;
    var vShader = createShader(gl, gl.VERTEX_SHADER, vShaderSource);
    var fShader = createShader(gl, gl.FRAGMENT_SHADER, fShaderSource);
    var program = createProgram(gl, vShader, fShader);

    var positionAttributeLocation = gl.getAttribLocation(program, 'a_position');
    var resolutionUniformLocation = gl.getUniformLocation(program, 'u_resolution');
    var colorLocation = gl.getUniformLocation(program, 'u_color');
    var positionBuffer = gl.createBuffer();
    var vao = gl.createVertexArray();
    gl.bindVertexArray(vao);
    
    gl.enableVertexAttribArray(positionAttributeLocation);
    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);

    gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);

    resizeCanvasToDisplaySize(gl.canvas);
    
    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
    
    gl.clearColor(0,0,0,0);
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

    gl.useProgram(program);
    gl.bindVertexArray(vao);

    gl.uniform2f(resolutionUniformLocation, gl.canvas.width, gl.canvas.height);
    for ( var i = 0;i<50;i++ ){
        setRect(gl, randInt(300), randInt(300), randInt(300), randInt(300));
        gl.uniform4f(colorLocation, Math.random(), Math.random(), Math.random(), 1);
        gl.drawArrays(gl.TRIANGLES, 0, 6);
    }
    </script>
</html>
